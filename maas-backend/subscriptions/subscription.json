{
    "$id": "http://maasglobal.com/maas-backend/subscriptions/subscription.json",
    "description": "MaaS subscription schema",
    "definitions": {
        "subscription": {
            "$ref": "#/definitions/subscriptionBase",
            "required": [
                "plan",
                "addons",
                "coupons",
                "changeState"
            ],
            "additionalProperties": true
        },
        "subscriptionCreatePayload": {
            "$ref": "#/definitions/subscriptionBase",
            "required": [
                "plan",
                "addons"
            ],
            "additionalProperties": true
        },
        "subscriptionUpdatePayload": {
            "$ref": "#/definitions/subscriptionBase",
            "required": [],
            "additionalProperties": true
        },
        "subscriptionBase": {
            "type": "object",
            "properties": {
                "id": {
                    "$ref": "http://maasglobal.com/maas-backend/subscriptions/contact.json#/definitions/identityId",
                    "$linkVal": "identityId",
                    "$linkPath": "contact.md"
                },
                "customerId": {
                    "$ref": "http://maasglobal.com/maas-backend/subscriptions/contact.json#/definitions/identityId",
                    "$linkVal": "identityId",
                    "$linkPath": "contact.md"
                },
                "plan": {
                    "$ref": "#/definitions/plan",
                    "$linkVal": "plan",
                    "$linkPath": "subscription.md"
                },
                "addons": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/addon",
                        "$linkVal": "addon",
                        "$linkPath": "subscription.md"
                    }
                },
                "coupons": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/coupon",
                        "$linkVal": "coupon",
                        "$linkPath": "subscription.md"
                    }
                },
                "terms": {
                    "$ref": "#/definitions/terms",
                    "$linkVal": "terms",
                    "$linkPath": "subscription.md"
                },
                "pointCost": {
                    "$ref": "http://maasglobal.com/core/components/point-cost.json",
                    "$linkVal": "point-cost",
                    "$linkPath": "point-cost.md"
                },
                "region": {
                    "$ref": "http://maasglobal.com/core/region.json",
                    "$linkVal": "region",
                    "$linkPath": "region.md"
                },
                "shippingAddress": {
                    "$ref": "http://maasglobal.com/maas-backend/subscriptions/subscriptionAddress.json",
                    "$linkVal": "subscriptionAddress",
                    "$linkPath": "subscriptionAddress.md"
                },
                "availability": {
                    "type": "object",
                    "additionalProperties": true
                },
                "name": {
                    "type": "string",
                    "minLength": 2
                },
                "description": {
                    "type": "string"
                },
                "meta": {
                    "description": "Arbitrary metadata on whatever app might need to display",
                    "type": "object",
                    "additionalProperties": true
                },
                "level": {
                    "type": "integer",
                    "minimum": 1
                },
                "wmpGrant": {
                    "type": "integer",
                    "minimum": 0
                },
                "active": {
                    "type": "boolean"
                },
                "hidden": {
                    "type": "boolean"
                },
                "selectable": {
                    "type": "boolean"
                },
                "topUpId": {
                    "type": "string",
                    "minLength": 2
                },
                "changeState": {
                    "$ref": "http://maasglobal.com/core/components/subscriptionChangeState.json",
                    "$linkVal": "subscriptionChangeState",
                    "$linkPath": "subscriptionChangeState.md"
                }
            },
            "additionalProperties": true
        },
        "plan": {
            "description": "Customer subscription plan",
            "type": "object",
            "properties": {
                "id": {
                    "$ref": "#/definitions/subscriptionItemId",
                    "$linkVal": "subscriptionItemId",
                    "$linkPath": "subscription.md"
                },
                "name": {
                    "type": "string",
                    "minLength": 1
                },
                "description": {
                    "type": "string"
                },
                "price": {
                    "$ref": "#/definitions/price",
                    "$linkVal": "price",
                    "$linkPath": "subscription.md"
                }
            },
            "required": [
                "id"
            ],
            "additionalProperties": true
        },
        "addon": {
            "description": "Customer subscription add-ons",
            "type": "object",
            "properties": {
                "id": {
                    "$ref": "#/definitions/subscriptionItemId",
                    "$linkVal": "subscriptionItemId",
                    "$linkPath": "subscription.md"
                },
                "name": {
                    "type": "string",
                    "minLength": 1
                },
                "description": {
                    "type": "string"
                },
                "quantity": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 200000,
                    "default": 1
                },
                "unitPrice": {
                    "$ref": "#/definitions/price",
                    "$linkVal": "price",
                    "$linkPath": "subscription.md"
                },
                "image": {
                    "$ref": "http://maasglobal.com/core/components/units.json#/definitions/url",
                    "$linkVal": "url",
                    "$linkPath": "units.md"
                }
            },
            "required": [
                "id",
                "quantity"
            ],
            "additionalProperties": true
        },
        "coupon": {
            "description": "Additional coupon that may provide discounts",
            "type": "object",
            "properties": {
                "id": {
                    "$ref": "#/definitions/subscriptionItemId",
                    "$linkVal": "subscriptionItemId",
                    "$linkPath": "subscription.md"
                },
                "name": {
                    "type": "string",
                    "minLength": 1
                },
                "description": {
                    "type": "string"
                }
            },
            "required": [
                "id"
            ]
        },
        "subscriptionItemId": {
            "description": "Identifier for matching the plans (Chargebee compat.)",
            "type": "string",
            "pattern": "^[^\\s\\/]{1,50}$"
        },
        "price": {
            "$ref": "http://maasglobal.com/core/components/cost.json"
        },
        "terms": {
            "description": "Terms related to this subscription",
            "type": "object",
            "properties": {
                "activated": {
                    "$ref": "http://maasglobal.com/core/components/units.json#/definitions/time",
                    "$linkVal": "time",
                    "$linkPath": "units.md"
                },
                "modified": {
                    "$ref": "http://maasglobal.com/core/components/units.json#/definitions/time",
                    "$linkVal": "time",
                    "$linkPath": "units.md"
                },
                "validity": {
                    "description": "Subscription validity conditions",
                    "type": "object",
                    "properties": {
                        "startTime": {
                            "$ref": "http://maasglobal.com/core/components/units.json#/definitions/time",
                            "$linkVal": "time",
                            "$linkPath": "units.md"
                        },
                        "endTime": {
                            "$ref": "http://maasglobal.com/core/components/units.json#/definitions/time",
                            "$linkVal": "time",
                            "$linkPath": "units.md"
                        }
                    },
                    "required": [
                        "startTime",
                        "endTime"
                    ]
                },
                "scheduledChanges": {
                    "type": "boolean",
                    "default": false
                }
            },
            "required": [
                "validity"
            ]
        }
    },
    "meta:status": "Develop",
    "title": "subscription"
}